<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>나의 오늘</title>
    <style>
        .schedule {
            margin-top: 20px;
            border: 1px solid #000;
            padding: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>나의 오늘</h1>
    
    <div id="color-buttons">
        <button style="background-color: lightblue;" onclick="setColor('lightblue')">파란색</button>
        <button style="background-color: lightgreen;" onclick="setColor('lightgreen')">초록색</button>
        <button style="background-color: lightcoral;" onclick="setColor('lightcoral')">빨간색</button>
        <button style="background-color: lightgoldenrodyellow;" onclick="setColor('lightgoldenrodyellow')">노란색</button>
        <button style="background-color: lightgray;" onclick="setColor('lightgray')">회색</button>
        <button onclick="setColor('')">지우기</button>
    </div>

    <button id="textInputButton" style="background-color: white;" onclick="toggleTextInput()">OFF</button>
    <button style="background-color: white;" onclick="addNewSchedule()">새로운 일과 기록표 추가</button>
    <button style="background-color: white;" onclick="saveSchedules()">저장</button>
    <button style="background-color: white;" onclick="loadSchedules()">불러오기</button>

    <div id="schedule-container">
    </div>

    <script>
        let scheduleCount = 0;
        let textInputMode = false;
        let currentColor = 'lightblue'; 

        function getCurrentDate() {
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const yyyy = today.getFullYear().toString().slice(2);
            return `${dd}${mm}${yyyy}`;
        }

        function addNewSchedule() {
            scheduleCount++;
            const container = document.getElementById('schedule-container');
            const todayDate = getCurrentDate();

            const newSchedule = document.createElement('div');
            newSchedule.className = 'schedule';
            newSchedule.dataset.date = todayDate;

            const toggleButton = document.createElement('button');
            toggleButton.textContent = "숨기기";
            toggleButton.onclick = function() {
                const table = newSchedule.querySelector('table');
                table.style.display = table.style.display === 'none' ? 'table' : 'none';
            };

            newSchedule.innerHTML = `
                <h2>${todayDate}</h2>
                <table>
                    <thead>
                        <tr>
                            <th>시간</th>
                            <th>10분</th>
                            <th>20분</th>
                            <th>30분</th>
                            <th>40분</th>
                            <th>50분</th>
                            <th>60분</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${createRows()}
                    </tbody>
                </table>
            `;

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '삭제';
            deleteButton.onclick = function() {
                container.removeChild(newSchedule);
            };

            newSchedule.appendChild(toggleButton);
            newSchedule.appendChild(deleteButton);
            container.appendChild(newSchedule);
        }

        function createRows() {
            const startHour = 7;
            const endHour = 3;
            let rows = '';

            for (let i = startHour; i <= 24 + endHour; i++) {
                const hour = i % 24;
                rows += `
                    <tr>
                        <td>${hour}:00</td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                    </tr>
                `;
            }
            return rows;
        }

        function setColor(color) {
            currentColor = color;
        }

        function toggleTextInput() {
            textInputMode = !textInputMode;
            const button = document.getElementById('textInputButton');
            button.textContent = textInputMode ? 'ON' : 'OFF';
            button.style.backgroundColor = textInputMode ? 'red' : 'white';
        }

        function handleCellClick(cell) {
            if (textInputMode) {
                const currentInput = prompt("내용을 입력하세요:", cell.innerText);
                if (currentInput !== null) {
                    cell.innerText = currentInput;
                }
            } else {
                cell.style.backgroundColor = cell.style.backgroundColor === currentColor ? '' : currentColor;
            }
        }

        function saveSchedules() {
            const schedules = [];
            const scheduleElements = document.querySelectorAll('.schedule');

            scheduleElements.forEach(schedule => {
                const date = schedule.dataset.date;
                const tableRows = schedule.querySelectorAll('tbody tr');
                const scheduleData = [];

                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const rowData = [];
                    cells.forEach(cell => {
                        // 텍스트가 없으면 빈 문자열을 저장하고, 색상만 저장
                        rowData.push(cell.innerText ? cell.innerText : cell.style.backgroundColor);
                    });
                    scheduleData.push(rowData);
                });

                schedules.push({ date, data: scheduleData });
            });

            localStorage.setItem('schedules', JSON.stringify(schedules));
            alert('일정이 저장되었습니다!');
        }

        function loadSchedules() {
            const schedules = JSON.parse(localStorage.getItem('schedules')) || [];
            const container = document.getElementById('schedule-container');
            container.innerHTML = ''; // 이전 일정을 지움

            schedules.forEach(schedule => {
                const newSchedule = document.createElement('div');
                newSchedule.className = 'schedule';
                newSchedule.dataset.date = schedule.date;

                const toggleButton = document.createElement('button');
                toggleButton.textContent = "숨기기";
                toggleButton.onclick = function() {
                    const table = newSchedule.querySelector('table');
                    table.style.display = table.style.display === 'none' ? 'table' : 'none';
                };

                newSchedule.innerHTML = `
                    <h2>${schedule.date}</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>시간</th>
                                <th>10분</th>
                                <th>20분</th>
                                <th>30분</th>
                                <th>40분</th>
                                <th>50분</th>
                                <th>60분</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${createRowsFromData(schedule.data)}
                        </tbody>
                    </table>
                `;

                const deleteButton = document.createElement('button');
                deleteButton.textContent = '삭제';
                deleteButton.onclick = function() {
                    container.removeChild(newSchedule);
                };

                newSchedule.appendChild(toggleButton);
                newSchedule.appendChild(deleteButton);
                container.appendChild(newSchedule);
            });
        }

        function createRowsFromData(data) {
            let rows = '';
            data.forEach(rowData => {
                rows += `
                    <tr>
                        <td>${rowData[0]}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[1] || ''}">${rowData[1] ? '' : ''}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[2] || ''}">${rowData[2] ? '' : ''}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[3] || ''}">${rowData[3] ? '' : ''}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[4] || ''}">${rowData[4] ? '' : ''}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[5] || ''}">${rowData[5] ? '' : ''}</td>
                        <td onclick="handleCellClick(this)" style="background-color: ${rowData[6] || ''}">${rowData[6] ? '' : ''}</td>
                    </tr>
                `;
            });
            return rows;
        }
    </script>
</body>
</html>

