<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 모바일 반응형 적용 -->
    <title>나의 오늘</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
        }
        .schedule {
            margin-top: 20px;
            border: 1px solid #000;
            padding: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px; /* padding 줄임 */
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #color-buttons {
            display: flex;
            flex-wrap: wrap; /* 모바일 환경에서 버튼이 넘치지 않도록 */
            gap: 5px;
            margin-bottom: 10px;
        }
        #color-buttons button {
            flex: 1; /* 버튼이 동일한 크기로 배치되도록 */
            min-width: 20px; /* 버튼이 너무 작아지지 않도록 최소 너비 설정 */
        }

        /* 반응형 웹 적용 */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }
            button {
                font-size: 14px;
                padding: 8px 16px;
            }
            table th, table td {
                font-size: 12px; /* 모바일에서 글자 크기 줄임 */
                padding: 5px;
            }
            #color-buttons {
                flex-direction: column; /* 모바일에서는 버튼이 세로로 배치되도록 */
            }
        }

        /* 아주 작은 화면(폰)용 */
        @media (max-width: 480px) {
            button {
                font-size: 12px;
                padding: 6px 12px;
            }
            table th, table td {
                font-size: 10px;
                padding: 3px;
            }
        }
    </style>
</head>
<body>
    <h1>나의 오늘</h1>
    
    <div id="color-buttons">
        <button style="background-color: lightblue;" onclick="setColor('lightblue')">파란색</button>
        <button style="background-color: lightgreen;" onclick="setColor('lightgreen')">초록색</button>
        <button style="background-color: lightcoral;" onclick="setColor('lightcoral')">빨간색</button>
        <button style="background-color: lightgoldenrodyellow;" onclick="setColor('lightgoldenrodyellow')">노란색</button>
        <button style="background-color: lightgray;" onclick="setColor('lightgray')">회색</button>
        <button onclick="setColor('')">지우기</button>
    </div>

    <button id="textInputButton" style="background-color: white;" onclick="toggleTextInput()">OFF</button>
    <button style="background-color: white;" onclick="addNewSchedule()">새로운 일과 기록표 추가</button>
    <button style="background-color: white;" onclick="saveSchedules()">저장</button>
    <button style="background-color: white;" onclick="loadSchedules()">불러오기</button>

    <div id="schedule-container"></div>

    <script>
        let scheduleCount = 0;
        let textInputMode = false;
        let currentColor = 'lightblue'; 

        function getCurrentDate() {
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const yyyy = today.getFullYear().toString().slice(2);
            return `${dd}${mm}${yyyy}`;
        }

        function addNewSchedule() {
            scheduleCount++;
            const container = document.getElementById('schedule-container');
            const todayDate = getCurrentDate();

            const newSchedule = document.createElement('div');
            newSchedule.className = 'schedule';
            newSchedule.dataset.date = todayDate;

            newSchedule.innerHTML = `
                <h2>${todayDate} <button onclick="toggleScheduleVisibility(this)">숨기기</button></h2>
                <table>
                    <thead>
                        <tr>
                            <th>시간</th>
                            <th>10분</th>
                            <th>20분</th>
                            <th>30분</th>
                            <th>40분</th>
                            <th>50분</th>
                            <th>60분</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${createRows()}
                    </tbody>
                </table>
            `;

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '삭제';
            deleteButton.onclick = function() {
                container.removeChild(newSchedule);
            };

            newSchedule.appendChild(deleteButton);
            container.insertBefore(newSchedule, container.firstChild); // 새 스케줄을 맨 위에 추가
        }

        function toggleScheduleVisibility(button) {
            const table = button.closest('.schedule').querySelector('table');
            table.style.display = table.style.display === 'none' ? 'table' : 'none';
            button.textContent = table.style.display === 'none' ? '보이기' : '숨기기';
        }

        function createRows() {
            const startHour = 7;
            const endHour = 3;
            let rows = '';

            for (let i = startHour; i <= 24 + endHour; i++) {
                const hour = i % 24;
                rows += `
                    <tr>
                        <td>${hour}:00</td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                        <td onclick="handleCellClick(this)"></td>
                    </tr>
                `;
            }
            return rows;
        }

        function setColor(color) {
            currentColor = color;
        }

        function toggleTextInput() {
            textInputMode = !textInputMode;
            const button = document.getElementById('textInputButton');
            button.textContent = textInputMode ? 'ON' : 'OFF';
            button.style.backgroundColor = textInputMode ? 'red' : 'white';
        }

        function handleCellClick(cell) {
            if (textInputMode) {
                const currentInput = prompt("내용을 입력하세요:", cell.innerText);
                if (currentInput !== null) {
                    cell.innerText = currentInput; // 사용자 입력으로 텍스트 변경
                }
            } else {
                // 색상 변경
                cell.style.backgroundColor = cell.style.backgroundColor === currentColor ? '' : currentColor;

                // 클릭한 셀에 텍스트를 설정하지 않도록 함
                if (cell.innerText.trim() === '') {
                    cell.innerText = ''; // 빈 문자열 유지 (기존 텍스트를 비운다)
                }
            }
        }

        function saveSchedules() {
            const schedules = [];
            const scheduleElements = document.querySelectorAll('.schedule');

            scheduleElements.forEach(schedule => {
                const date = schedule.dataset.date;
                const isHidden = schedule.querySelector('table').style.display === 'none'; // 숨김 상태 저장
                const tableRows = schedule.querySelectorAll('tbody tr');
                const scheduleData = [];

                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const rowData = [];
                    cells.forEach(cell => {
                        const cellText = cell.innerText.trim();
                        const cellBgColor = cell.style.backgroundColor;

                        // 배경색과 텍스트를 모두 저장
                        rowData.push({
                            text: cellText,
                            bgColor: cellBgColor ? cellBgColor : ''
                        });
                    });
                    scheduleData.push(rowData);
                });

                schedules.push({ date, isHidden, data: scheduleData });
            });

            localStorage.setItem('schedules', JSON.stringify(schedules));
        }

        function loadSchedules() {
            const savedSchedules = JSON.parse(localStorage.getItem('schedules'));
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';

            if (savedSchedules && savedSchedules.length > 0) {
                savedSchedules.forEach(schedule => {
                    const newSchedule = document.createElement('div');
                    newSchedule.className = 'schedule';
                    newSchedule.dataset.date = schedule.date;

                    const tableDisplay = schedule.isHidden ? 'none' : 'table';

                    newSchedule.innerHTML = `
                        <h2>${schedule.date} <button onclick="toggleScheduleVisibility(this)">${schedule.isHidden ? '보이기' : '숨기기'}</button></h2>
                        <table style="display: ${tableDisplay};">
                            <thead>
                                <tr>
                                    <th>시간</th>
                                    <th>10분</th>
                                    <th>20분</th>
                                    <th>30분</th>
                                    <th>40분</th>
                                    <th>50분</th>
                                    <th>60분</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${loadRows(schedule.data)}
                            </tbody>
                        </table>
                    `;

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '삭제';
                    deleteButton.onclick = function () {
                        container.removeChild(newSchedule);
                    };

                    newSchedule.appendChild(deleteButton);
                    container.appendChild(newSchedule);
                });
            }
        }

        function loadRows(data) {
            let rows = '';

            data.forEach(rowData => {
                rows += '<tr>';
                rowData.forEach(cellData => {
                    rows += `<td style="background-color: ${cellData.bgColor}" onclick="handleCellClick(this)">${cellData.text}</td>`;
                });
                rows += '</tr>';
            });

            return rows;
        }
    </script>
</body>
</html>
